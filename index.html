<!DOCTYPE html>
<html>
  <head>
    <title>ISS Path - Engaging with the International Space Station</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
    <meta charset="UTF-8">
    <link rel="stylesheet" href="css/app.min.css">
    <style>
      /* TODO */
    </style>
  </head>

  <body>
    <div class="app-page" data-page="home">
      <div class="app-topbar">
        <div class="app-title">ISS Path</div>
      </div>
      <div class="app-content">
        <div class="app-section">
          <div class="app-button" data-target="page2">three.js Example</div>
          <div class="app-button" data-target="page3">d3.js Example</div>
        </div>
        <div>
	      	<table>
				<tr>
					<th></th>
					<th>Position(km)</th>
					<th>Velocity(m/s)</th>
				</tr>
				<tr>
					<td>X</td>
					<td id="USLAB000032"></td>
					<td id="USLAB000035"></td>
				</tr>
				<tr>
					<td>Y</td>
					<td id="USLAB000033"></td>
					<td id="USLAB000036"></td>
				</tr>
				<tr>
					<td>Z</td>
					<td id="USLAB000034"></td>
					<td id="USLAB000037"></td>
				</tr>
			</table>
		</div>
      </div>
    </div>

    <div class="app-page" data-page="page2">
      <div class="app-topbar">
        <div class="app-button left" data-back data-autotitle></div>
        <div class="app-title">three.js Example</div>
      </div>
      <div class="app-content">
        <h1>A Simple thress.js example</h2>
        <div id="threejs-container"></div>
      </div>
    </div>

    <div class="app-page" data-page="page3">
      <div class="app-topbar">
        <div class="app-button left" data-back data-autotitle></div>
        <div class="app-title">d3.js Example</div>
      </div>
      <div class="app-content">
        <h1>A Simple d3.js example</h2>
        <div id="d3js-container"></div>
      </div>
    </div>

    <script src="cordova.js"></script>
    <script src="js/jquery-2.1.3.min.js"></script>
    <script src="js/require.js"></script>
    <script src="js/lightstreamer.js"></script>
    <script src="js/app.min.js"></script>

    <script type="text/javascript" src="js/three.min.js"></script>
	

    <script>
      App.controller('home', function (page) {
      	$(page).on('appShow', function () {
	      	require(["LightstreamerClient","Subscription"],function(LightstreamerClient,Subscription) {
				var client = new LightstreamerClient("https://push.lightstreamer.com","ISSLIVE");
				client.connect();
				
				var sub = new Subscription("MERGE",["USLAB000032","USLAB000035","USLAB000033","USLAB000036","USLAB000034","USLAB000037"],["Value"]);
				client.subscribe(sub);
				
				sub.addListener({
					onItemUpdate: function(update) {
						$("#"+update.getItemName()).text(update.getValue("Value"));
					}
				});
			});
      	});
      });

      App.controller('page2', function (page) {
        $(page).on('appShow', function () {

	        // set the scene size
			var WIDTH = 400,
			    HEIGHT = 300;

			// set some camera attributes
			var VIEW_ANGLE = 45,
			    ASPECT = WIDTH / HEIGHT,
			    NEAR = 0.1,
			    FAR = 10000;

			// get the DOM element to attach to
			// - assume we've got jQuery to hand
			var $container = $('#threejs-container');

			// create a WebGL renderer, camera
			// and a scene
			var renderer = new THREE.WebGLRenderer();
			var camera = new THREE.PerspectiveCamera(  VIEW_ANGLE,
			                                ASPECT,
			                                NEAR,
			                                FAR  );
			var scene = new THREE.Scene();

			// the camera starts at 0,0,0 so pull it back
			camera.position.z = 300;

			// start the renderer
			renderer.setSize(WIDTH, HEIGHT);

			// attach the render-supplied DOM element
			$container.append(renderer.domElement);

			// create the sphere's material
			var sphereMaterial = new THREE.MeshLambertMaterial(
			{
			    color: 0xCC0000
			});

			// set up the sphere vars
			var radius = 50, segments = 16, rings = 16;

			// create a new mesh with sphere geometry -
			// we will cover the sphereMaterial next!
			var sphere = new THREE.Mesh(
			   new THREE.SphereGeometry(radius, segments, rings),
			   sphereMaterial);

			// add the sphere to the scene
			scene.add(sphere);

			// and the camera
			scene.add(camera);

			// create a point light
			var pointLight = new THREE.PointLight( 0xFFFFFF );

			// set its position
			pointLight.position.x = 10;
			pointLight.position.y = 50;
			pointLight.position.z = 130;

			// add to the scene
			scene.add(pointLight);

			// draw!
			renderer.render(scene, camera);
		});
      });

	  App.controller('page3', function (page) {
      	$(page).on('appShow', function () {
	      	require.config({paths: {d3: "js/d3.v3.min"}});

			require(["d3"], function(d3) {
			  	var sampleSVG = d3.select("#d3js-container")
			        .append("svg")
			        .attr("width", 100)
			        .attr("height", 100);    

			    sampleSVG.append("circle")
			        .style("stroke", "gray")
			        .style("fill", "white")
			        .attr("r", 40)
			        .attr("cx", 50)
			        .attr("cy", 50)
			        .on("mouseover", function(){d3.select(this).style("fill", "aliceblue");})
			        .on("mouseout", function(){d3.select(this).style("fill", "white");})
			        .on("mousedown", animateFirstStep);

				function animateFirstStep(){
				    d3.select(this)
				      .transition()            
				        .delay(0)            
				        .duration(1000)
				        .attr("r", 10)
				        .each("end", animateSecondStep);
				};

				function animateSecondStep(){
				    d3.select(this)
				      .transition()
				        .duration(1000)
				        .attr("r", 40);
				};
			});

	      	
      	});
      });

		

      try {
        App.restore();
      } catch (err) {
        App.load('home');
      }
    </script>
  </body>
</html>
